In this section, we follow the proof showing that the $WFA$ is $2k-1$ competitive from~\cite{OnlineComp1998}, along with some in-depth explanatory details. We start by defining the term $w(C)$, the work done to service a request sequence $\sigma_i$ and end in configuration $C$, assuming an initial starting configuration $C_0$. Additionally, we define $w'(C)$ as the work done to service a request sequence $\sigma_{i+1}$ and end in the configuration $C$. It is worth noting a basic property of the work function:

\begin{equation}
    \label{eq:work}
    w'(C) = min_{x \in C} [w'(C - x + r) + d(r, x)] = min_{x \in C} [w(C - x + r) + d(r, x)]
\end{equation}

The first part of this says that the work done to service a request sequence \textit{including} the next request $r$ for some configuration $C$ is equal to the minimum work done to service the same request sequence, except on the configuration $C$ without the point $x$ and with the point $r$, plus the distance between $r$ and $x$. The set $C-x+r$ is defined as in~\cite{OnlineComp1998}, where there is only one copy of $r$ in this set, whether or not $r$ was originally in $C$. 

The nice part about this is that we now \textit{know} that $r \in C - x + r$, which isn't necessarily true of $C$. This means that the second part of this equation is true, where we can remove the $r$ from the work function, as it is already included in the set. 

\begin{definition}
    The \textbf{offline pseudocost} $w'(C') - w(C)$ is the work done to service a request sequence $\sigma_{i+1}$ and end in configuration $C'$, minus the work done to service a request sequence $\sigma_i$ and end in configuration $C$.
\end{definition}

The offline pseudocost is a measure of how much work is done to service the next request in the sequence, given that the current configuration is $C$. If we sum this across all requests on sets $C_0$, $C_1$ ... $C_n$ for the configuration of \textit{OPT}, we will see that this will telescope to $w_{\sigma}(C_n) - w_{\emptyset}(C_0)$, where $w_{\theta}(\centerdot)$ is the work done on request sequence $\theta$ to get into a given configuration. This is equal to the cost $OPT(\sigma)$, as we are subtracting the cost to get into the initial configuration $C_0$ from the final work function $w_\sigma(C_n)$.

\begin{definition}
    The \textbf{extended cost} is defined as $max_X \{ w'(X) - w(X)\}$.
\end{definition}

The extended cost represents the worst case configuration we could be in given the next request. That is, the configuration that will maximize the cost incurred to satisfy the next request. The extended cost represents the maximum cost we could incurr by servicing the next request online.

\begin{definition}
    A work function is \textbf{Quasi-Convex} (QC) if for all configurations $X$, $Y$, and for all $x \in X$, the following property holds:
    \begin{equation*}
        min_{y \in Y} \{ w(X - x + y) + w(Y - y + x)\} \leq w(X) + w(Y)
    \end{equation*}
\end{definition}

Quasi-Convexity essentially says that for every two configurations, the sum of the costs to get into those configurations is greater than or equal to the \textit{best} cost of swapping \textit{some} point $y\in Y$ with $x$. The key point here is that there will be some minimizing configurations $X$ and $Y$. We can additionally take this a step further with the following definition.

\begin{definition}
A work function is \textbf{General Quasi-Convex} (GQC) if for every $X$, $Y$, there exists a bijection $X \rightarrow Y$ such that for all partitions of X into $X_1$ and $X_2$, the following property holds:

\begin{equation*}
    w(X_1 + g(X_2)) + w(g(X_1) + X_2) \leq w(X_1) + w(X_2)
\end{equation*}
\end{definition}

It is worth noting that if a work function is GQC, then it is also QC. This is because we can set $X_1 = X-x$ and $y = g(x)$. This will give us the QC property.

\begin{lemma}
    If a bijection $g$ satisfies the GQC property, then there exists a bijection $\tilde{g}$ that satisfies the GQC property such that $\tilde{g}(x) = x$ for all $x \in X \cap Y$.
\end{lemma}
\begin{proof}
    Suppose we have a bijection $g: X \rightarrow Y$ that satisfies the GQC property, and additionally of all such bijections, maps the \textit{maximum} number of elements in $X \cap Y$ to themselves. by contradiction, assume that there exists some $a \in X \cap Y$ such that $g(a) \neq a$. Now, we define $\tilde{g}: X \rightarrow Y$ such that:
    
    \begin{equation*}
        \tilde{g}(x) = \begin{cases}
            g(x) & \text{if } x \neq a \text{ or } x \neq g^{-1}(a) \\
            a & \text{if } x = a \\
            g^{-1}(a) & \text{if } x = g^{-1}(a)
        \end{cases}
    \end{equation*}
    
    Now, let $(X_1, X_2)$ be a partition of $X$, and without loss of generality, $g^{-1}(a) \in X_1$. If $a \in X_1$, then $g(X_1) = \tilde(g)(X_1)$, and $g(X_2) = \tilde{g}(X_2)$, and so $\tilde(g)$ satisfies the GQC property, which is a contradiction to our second assumption. Therefore, $a \not\in X_1$, and so we have:

    \begin{equation*}
        w(X) + w(Y) \geq w((X_1+a) \cup g(X_2-a)) + w(g(x_1+a) \cup (X_2-a))
    \end{equation*}

    By the definition of GQC. Then, since $a, g^{-1}(a) \not \in X_2$, we know that $g(X_2-a) = \tilde(g)(X_2-a)$, by the definition of $\tilde{g}$. Additionally, $g(X_1+a) = \tilde{g}(X_1+a)$, since $a, g^{-1}(a) \in X_1$. Therefore, we have: 
    
    \begin{equation*}
    \begin{gathered}
        w((X_1+a) \cup g(X_2-a)) + w(g(x_1+a) \cup (X_2-a)) = w((X_1+a) \cup \tilde{g}(X_2-a)) + w(\tilde{g}(X_1+a) \cup (X_2-a)) 
        \\ = w(X_1 \cup \tilde{g}(X_2)) + w(\tilde{g}(X_1) \cup X_2)
    \end{gathered}
    \end{equation*}

    We achieve the last equality because $a \in X_1$ and $a \not\in X_2$, so $X_1 - a = X_1$ and $X_2 - a = X_2$. This would mean that $\tilde{g}$ satisfies the GQC property, which is again a contradiction. Therefore, there exists a bijection $\tilde{g}$ that satisfies the GQC property such that $\tilde{g}(x) = x$ for all $x \in X \cap Y$.
\end{proof}
\begin{lemma}
All work functions are GQC, and so are therefore also QC.
\end{lemma}

\begin{proof}
    We prove this by induction on the length of the request sequence. Our base case has $i = 0$, where $w_{\emptyset}(X) + w_{\emptyset}(Y) = D(C_0, X) + D(C_0, Y)$. We consider two minimum weight matchings, whose values are $D(C_0, X)$, and $D(C_0, Y)$. Each $c_j \in C_O$ is mapped by $M_X$ to some $x_j \in X$ and by $M_Y$ to some $y_j \in Y$. We show that the bijection $g(x_j) = y_j$ satisfies the GQC property. Because X and Y are minimum weight matchings, $w(X) + w(Y)$ is an upper bound of $D(X, Y)$. By the difinition of $g$, we maintain the indeces of our points when transitioning $X \rightarrow C_0 \rightarrow Y$. By a pointwise approach, we see that we satsify the GQC property with equality. We can think of this as doubling the number of servers at locations in $C_0$ and then matching them to the points in $X$ and $Y$. Each point in $X$ and $Y$ will appear exactly once on either side of the equation.

    For the induction step, we assume $w$ satisfies the GQC property, and we now have a new request $r$. We show that $w'$ satisfies GQC. We know that there exists some $x \in X$ such that $w'(X) = w(X-x+r) + d(x,r)$, and similarly there exists some $y \in Y$ such that $w'(Y) = w(Y-y+r) + d(y,r)$. We know there exists a bijectiong $g: (X-x+r) \rightarrow (Y-y+r)$ that satsfies the GQC property, where $g(r) = r$. We define $\tilde{g}: X \rightarrow Y$ as follows:

    \begin{equation*}
        \tilde{g}(z) = \begin{cases}
            g(z) & \text{if } z \neq r \\
            y & \text{if } z = r
        \end{cases}
    \end{equation*}

    From here, we will have $X_{xr} = X - x + r$ and $Y_{yr} = Y - y + r$ for easier notation. Without loss of generality, assume that $x \in X_1$ for some partition $X_1, X_2$ of $X$. We have:

    \begin{equation*}
        \begin{gathered}
            w'(X) + w'(Y) = w(X_{xr}) + w(Y_{yr}) + d(r, x) + d(r, y) \\
            = w( (X_1-x+r) \cup g(X_2)) + w(Y_{yr}) + d(r, x) + d(r, y) \\
            \geq w((X_1-x+r) \cup g(X_2)) + w(g(X_1-x+r) \cup (X_2)) + d{x, r} + d{r, y} \\
            = w(X_{xr} \cup \tilde{g}(X_2)) + w((\tilde{g}(X_1) -y + r) \cup X_2) + d(x, r) + d(r, y) \\
            \geq w'(X_1 \cup g'(X_2)) + w'(g'(X_1) \cup X_2) 
        \end{gathered}
    \end{equation*}
\end{proof}

\begin{definition}
    Let $w$ be the current work function and let $r$ be any point in our metric space. A configuration $A$ is called a \textbf{minimizer of $r$ with respect to $w$} if:
    \begin{equation*}
        A = argmin_{(X)} \{ w(X) - \Sigma_{x \in X} d(x,r)\}
    \end{equation*}
\end{definition}

\begin{lemma}
    Let $w$ be the current work function and let $r$ be the next request. If $A$ is a minimizer of $r$ with respect to $w$, then $A$ is also a minimizer of $r$ with respect to $w'$.
\end{lemma}

\begin{proof}
    We want to show that for every $B$, $w'(A) - \Sigma_{a \in A} d(a,r) \leq w'(B) - \Sigma_{b \in B} d(b,r)$. This is equivalent to showing the following, as per property~\ref{eq:work}:
    
    \begin{equation*}
        \begin{gathered}
            min_{a' \in A} \{ w(A - a' + r) + d(a', r) - \Sigma_{a \in A} d(a,r)\} \leq min_{b' \in B} \{ w(B - b' + r) + d(b', r) - \Sigma_{b \in B} d(b,r)\}
        \end{gathered}
    \end{equation*}

    Since $A$ is a minimizer of $r$ with respect to $w$:

    \begin{equation*}
        \begin{gathered}
            w(A) - \Sigma_{a \in A} d(a,r) \leq w(B-b' + a') - \Sigma_{b \in B - b' + a'} d(b, r) \\ \\
            w(A) - w(B-b' + a') - \Sigma_{a \in A} d(a,r) \leq -\Sigma_{b \in B} d(b, r) + d(b', r) - d(a', r) \\ \\
            -w(B - b' + a') + w(A) + d(a', r) - \Sigma_{a \in A} d(a,r) \leq -\Sigma_{b \in B} d(b,r) + d(b', r)
        \end{gathered}
    \end{equation*}

    Now, we apply the GQC Lemma, with $X = B -b' + r$, $Y = A$, $x = r$, and $y = a'$. This means that $min_{a' \in A} \{ w(B - b' + a') + w(A -a' + r)\} \leq w(B - b' + r) + w(A)$. We now sum the two sides of this with the previous inequality to get the following equation:

    \begin{equation*}
        \begin{gathered}
            min_{a' \in A} \{ w(B - b' + a') + w(A -a' + r) - w(B - b' + a') + w(A) + d(a', r) + \Sigma_{a \in A} d(a, r)\} \\
            \leq w(B - b' + r) + w(A) + d(b' ,r) - \Sigma_{b \in B} d(b, r)
        \end{gathered}
    \end{equation*}

    And after cancelations, we get that for all $b' \in B$:

    \begin{equation*}
        \begin{gathered}
            min_{a' \in A} \{ w(A - a' + r) + d(a', r) - \Sigma_{a \in A} d(a,r)\} \leq w(B - b' + r) + d(b', r) - \Sigma_{b \in B} d(b,r)
        \end{gathered}
    \end{equation*}

    Since this is true for all $b' \in B$, our property holds for the $b'$ that minimizes the right hand side, completing our proof.
\end{proof}

\begin{definition}
    We define the \textbf{extended cost} as the cost of the value achieved by the configuration which is able to maximize the difference between the next work function value and the current work function value:
    \begin{equation*}
        max_X \{ w'(X) - w(X)\}
    \end{equation*}
\end{definition}

\begin{definition}
    Additionally, we define a \textbf{maximizer with respect to $w$} as the configuration $A$ which achieves this extended cost value:
    \begin{equation*}
        A = argmax_X \{ w'(X) - w(X) \}
    \end{equation*}
\end{definition}

\begin{lemma}
    Any minimizer with respect to $r$ is also a maximizer with respect to $w$.
\end{lemma}

\begin{proof}
    Suppose $A$ is a minimizer with respect to $r$. We want to show that for every $B$,

    \begin{equation*}
        \begin{gathered}
            w'(B) - w(B) \leq w'(A) - w(A) \\ \\
            w'(B) + w(A) \leq w'(A) + w(B)
        \end{gathered}
    \end{equation*}

    If $r \in B$, then this statement is true, as $w'(B) = w(B)$, and $w(A) \leq w'(A)$ by definition.

    By expanding the above desired equation using eq.~\ref{eq:work}, we get that we want to show:

    \begin{equation*}
        \begin{gathered}
            min_{b' \in B} \{ w(B - b' + r) + d(b', r) + w(A)\} \leq min_{a' \in A} \{ w(A - a' + r) + d(a', r) + w(B)\}
        \end{gathered}
    \end{equation*}

    This is equivalent to saying that for all $B$, $a' \in A$: 

    \begin{equation*}
        \begin{gathered}
            min_{b' \in B} \{ w(B - b' + r) + d(b', r) + w(A)\} \leq w(A - a' + r) + d(a', r) + w(B)
        \end{gathered}
    \end{equation*}

    To show this, we begin with the statement that $A$ is a minimizer. In particular, this means that:

    \begin{equation*}
        \begin{gathered}
            w(A) - \Sigma_{a \in A} d(a,r) \leq w(A -a' + b') - \Sigma_{a \in A - a' + b'} d(a,r) \\ \\
            w(A) - \Sigma_{a \in A} d(a,r) \leq w(A -a' + b') - \Sigma_{a \in A} d(a,r) + d(a', r) - d(b', r) \\ \\
            w(A) + d(b', r) - d(a', r) \leq w(A - a' + b')
        \end{gathered}
    \end{equation*}

    When we apply the QC property with $X = A - a' + r$, $Y = B$, $x = r$, and $y = b'$, and then substitute in for $w(A - a' + b')$, we get:

    \begin{equation*}
        \begin{gathered}
            min_{b' \in B} \{ w(A - a' + b') + w(B - b' + r)\} \leq w(A - a' + r) + w(B) \\ \\
            min_{b' \in B} \{ w(A) + d(b', r) - d(a', r) + w(B - b' + r)\}\leq w(A - a' + r) + w(B) \\ \\
            min_{b' \in B} \{ w(B - b' + r) + d(b', r) + w(A)\} \leq w(A - a' + r) + d(a', r) + w(B)
        \end{gathered}
    \end{equation*}
\end{proof}

\begin{definition}
    We now define the \textbf{value of a minimizer configuration}, for minimizer $A$ of $r$ with respect to $w$ as: 
    \begin{equation}
        MIN_w(r) = w(A) - \Sigma_{a \in A} d(a, r)
    \end{equation}
\end{definition}

We now fix any optimal algorithm $OPT$, and have $U = \{u_1, u_2, ... , u_k \}$ as the current configuration of $OPT$. We will now have the potential function: $\Phi ( U, w) = \Sigma_{u \in U} MIN_w(u)$. Additionally, suppose that for the next request $r$, $OPT$ services the request with server $u_j$. Then, the next configuration of $OPT$ is $U' = U - u_j + r$.

\begin{lemma}
    $\Phi ( U', w) - \Phi (U, w) \geq k * d(u_j, r)$
\end{lemma}

\begin{proof}
    \begin{equation*}
        \Phi ( U', w) - \Phi (U, w) = \Sigma_{u \in U'} MIN_w(u) - \Sigma_{u \in U} MIN_w(u) \\ = MIN_w(r) - MIN_w(u_j)
    \end{equation*}

    Using the triangle inequality, we know that for all $a$, $d(a, r) \leq d(a, u_j) + d(u_j, r)$. 
\end{proof}
% \begin{definition}
%     \label{def:off}
%     The \textbf{offline pseudocost} $w' (C') - w(C') is the work done to $